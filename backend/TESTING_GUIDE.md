# Testing Guide - PDF Upload, YouTube URL & MCQ Generation

## Prerequisites
1. Server running on `http://localhost:8000`
2. Valid JWT token (obtained after login/registration)
3. A PDF file for testing
4. API testing tool (Postman, Thunder Client, or curl)

## Step-by-Step Testing Process

### Step 1: Register/Login to Get JWT Token

**Endpoint:** `POST http://localhost:8000/auth/register`

**Request Body:**
```json
{
  "email": "test@example.com",
  "password": "testpass123",
  "full_name": "Test User"
}
```

**Expected Response:**
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer"
}
```

**Save the `access_token` - you'll need it for all subsequent requests!**

---

### Step 2: Upload PDF and Extract Text

**Endpoint:** `POST http://localhost:8000/upload/pdf`

**Headers:**
```
Authorization: Bearer YOUR_ACCESS_TOKEN_HERE
Content-Type: multipart/form-data
```

**Request Body:**
- Form-data with key: `file`
- Value: Select your PDF file

**Expected Response:**
```json
{
  "filename": "your_file.pdf",
  "file_path": "app/storage/uploads/user_id_your_file.pdf",
  "extracted_text": "First 500 characters of extracted text...",
  "full_text_length": 5000
}
```

**Save the `extracted_text` or note the `file_path` for next step!**

---

### Step 3: Generate AI Module with YouTube URL and MCQs

**Endpoint:** `POST http://localhost:8000/modules/generate-ai`

**Headers:**
```
Authorization: Bearer YOUR_ACCESS_TOKEN_HERE
Content-Type: application/json
```

**Request Body:**
```json
{
  "extracted_text": "PASTE_THE_EXTRACTED_TEXT_FROM_STEP_2_HERE"
}
```

**Expected Response:**
```json
{
  "module": {
    "id": "module_id_here",
    "user_id": "user_id_here",
    "title": "AI Generated Title Based on PDF Content",
    "content": "Detailed learning content generated by AI...",
    "pdf_text": "Original extracted text...",
    "video_id": "YouTube_Video_ID",
    "created_at": "2024-01-01T00:00:00"
  },
  "mcqs": [
    {
      "question": "What is the main topic?",
      "options": ["Option A", "Option B", "Option C", "Option D"],
      "correct_answer": "Option A"
    },
    {
      "question": "Another question?",
      "options": ["Option A", "Option B", "Option C", "Option D"],
      "correct_answer": "Option B"
    }
  ],
  "video_id": "YouTube_Video_ID"
}
```

**The response includes:**
- ✅ **Module**: Saved learning module with AI-generated content
- ✅ **MCQs**: Multiple choice questions for testing knowledge
- ✅ **video_id**: YouTube video ID (watch at `https://www.youtube.com/watch?v=VIDEO_ID`)

---

## Testing with cURL Commands

### 1. Register User
```bash
curl -X POST http://localhost:8000/auth/register ^
  -H "Content-Type: application/json" ^
  -d "{\"email\":\"test@example.com\",\"password\":\"testpass123\",\"full_name\":\"Test User\"}"
```

### 2. Upload PDF
```bash
curl -X POST http://localhost:8000/upload/pdf ^
  -H "Authorization: Bearer YOUR_TOKEN_HERE" ^
  -F "file=@path/to/your/file.pdf"
```

### 3. Generate AI Module
```bash
curl -X POST http://localhost:8000/modules/generate-ai ^
  -H "Authorization: Bearer YOUR_TOKEN_HERE" ^
  -H "Content-Type: application/json" ^
  -d "{\"extracted_text\":\"YOUR_EXTRACTED_TEXT_HERE\"}"
```

---

## Testing with Postman

### Collection Setup:
1. Create a new collection called "Learning Platform"
2. Add an environment variable `token` to store JWT token
3. Add an environment variable `base_url` = `http://localhost:8000`

### Request 1: Register
- Method: POST
- URL: `{{base_url}}/auth/register`
- Body (JSON):
```json
{
  "email": "test@example.com",
  "password": "testpass123",
  "full_name": "Test User"
}
```
- Test Script (to save token):
```javascript
pm.environment.set("token", pm.response.json().access_token);
```

### Request 2: Upload PDF
- Method: POST
- URL: `{{base_url}}/upload/pdf`
- Headers: `Authorization: Bearer {{token}}`
- Body: form-data, key=`file`, type=File, select PDF
- Test Script (to save extracted text):
```javascript
pm.environment.set("extracted_text", pm.response.json().extracted_text);
```

### Request 3: Generate AI Module
- Method: POST
- URL: `{{base_url}}/modules/generate-ai`
- Headers: `Authorization: Bearer {{token}}`
- Body (JSON):
```json
{
  "extracted_text": "{{extracted_text}}"
}
```

---

## Verification Checklist

✅ **PDF Upload Feature:**
- [ ] PDF file is accepted
- [ ] Text is extracted successfully
- [ ] Response includes extracted_text and file_path

✅ **YouTube URL Feature:**
- [ ] video_id is returned in response
- [ ] Video URL works: `https://www.youtube.com/watch?v=VIDEO_ID`
- [ ] Video is relevant to PDF content

✅ **MCQ Generation Feature:**
- [ ] MCQs array is returned
- [ ] Each MCQ has question, options, and correct_answer
- [ ] Questions are relevant to PDF content
- [ ] At least 3-5 MCQs are generated

✅ **Module Creation:**
- [ ] Module is saved with AI-generated title and content
- [ ] Module can be retrieved later via GET /modules/{module_id}

---

## Troubleshooting

### Error: "Not authenticated"
- Check if Authorization header is present
- Verify token format: `Bearer YOUR_TOKEN`
- Token might be expired (30 min expiry)

### Error: "Only PDF files allowed"
- Ensure file has .pdf extension
- Check file is not corrupted

### Error: "PDF appears to be empty"
- PDF might be image-based (scanned)
- Try a different PDF with text content

### Error: API key issues
- Check .env file has valid GEMINI_API_KEY and YOUTUBE_API_KEY
- Run `python test_apis.py` to verify API connectivity

---

## Quick Test Flow

1. **Start Server**: `python run.py`
2. **Register**: POST to `/auth/register`
3. **Copy Token**: Save the access_token
4. **Upload PDF**: POST to `/upload/pdf` with Authorization header
5. **Copy Extracted Text**: Save the extracted_text from response
6. **Generate Module**: POST to `/modules/generate-ai` with extracted_text
7. **Verify Response**: Check module, mcqs, and video_id in response
8. **Watch Video**: Open `https://www.youtube.com/watch?v=VIDEO_ID`
9. **Test MCQs**: Use the questions to test knowledge

---

## Sample PDF Content for Testing

If you don't have a PDF, create a simple text file and convert to PDF with content like:

```
Introduction to Python Programming

Python is a high-level, interpreted programming language known for its simplicity and readability. 
It was created by Guido van Rossum and first released in 1991.

Key Features:
- Easy to learn and use
- Extensive standard library
- Cross-platform compatibility
- Large community support

Python is widely used in web development, data science, artificial intelligence, and automation.
```

This will generate relevant MCQs and find appropriate YouTube tutorials!
